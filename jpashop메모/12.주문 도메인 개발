주문 도메인 개발


구현기능
	상품 주문
	주문 내역 조회
	주문 취소
	
순서
	주문 엔티티, 주문상품 엔티티 개발
	주문 리포지토리 개발
	주문 서비스 개발
	주문 검색 기능 개발
	주문 기능 테스트

도메인 위주 개발 코드를 이해할 수 있다.
==============================================================================================================

주문, 주문상품 엔티티 개발

연관관계가 복잡한 엔티티는 별도의 생성 메서드가 있는 것이 좋다.
이렇게 생성메서드가 있으면 생성시점을 바꾸거나 할 때 이 메서드의 위치만 변경해주면 된다.
    public static Order createOrder (Member member, Delivery delivery, OrderItem... orderItems){
        Order order = new Order();
        order.setMember(member);
        order.setDelivery(delivery);
        for (OrderItem orderItem : orderItems) {
            order.addOrderItem(orderItem);
        }
        order.setStatus(OrderStatus.ORDER);
        order.setOrderDate(LocalDateTime.now());

        return order;
    }

주문취소  메서드
    public void cancel(){
        if(delivery.getDeliveryStatus() == DeliveryStatus.COMP){
            throw new IllegalStateException("이미 배송완료한 상품은 취소가 불가능합니다.");
        }
        
        this.setStatus(OrderStatus.CANCEL);
        for (OrderItem orderItem : orderItems) {
            orderItem.cancel();
        }
    }

==============================================================================================================

주문 리포지토리 개발

    /**
     * 주문
     */
    @Transactional
    public Long order(Long memberId, Long itemId, int count){

        //엔티티 조회
        Member member = memberRepository.findOnd(memberId);
        Item item = itemRepository.findOne(itemId);

        //배송정보 설정
        Delivery delivery = new Delivery();
        delivery.setAddress(member.getAddress());

        //주문상품 생성
        OrderItem orderItem = OrderItem.createOrderItem(item, item.getPrice(), count);

        //주문 생성
        Order order = Order.createOrder(member, delivery, orderItem);

        //주문 저장
        orderRepository.save(order);

        return order.getId();
    }
    
하나만 save 해줘도 되는 이유는 Order 엔티티 속 Delivery나 OrderItems가  cascade = CascadeType.ALL 로 설정되어있기 때문에 자동으로 persist 된다.
Cascade를 써야하는 경우 해당 엔티티를 참조하는 부모엔티티가 하나일 경우 써도 된다.
하지만 참조를 여러군데에서 하는 경우는 하나씩 persist 하는 것이 좋다.